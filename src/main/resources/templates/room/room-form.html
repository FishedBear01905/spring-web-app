<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Room Form</title>
    <script>
        let betTargetCount = 0;

        function addBetTarget() {
            if (betTargetCount >= 99) {
                alert("これ以上追加できません。");
                return;
            }

            const container = document.getElementById("betTargetContainer");
            const div = document.createElement("div");
            div.setAttribute("id", `betTarget-${betTargetCount}`);
            div.innerHTML = `
                <h4>Bet Target ${betTargetCount}</h4>
                <label for="betTargets[${betTargetCount}].targetTitle">タイトル:</label>
                <input type="text" id="betTargets[${betTargetCount}].targetTitle" name="betTargets[${betTargetCount}].targetTitle" required><br>

                <label for="betTargets[${betTargetCount}].targetDescription">詳細:</label>
                <textarea id="betTargets[${betTargetCount}].targetDescription" name="betTargets[${betTargetCount}].targetDescription" required></textarea><br>
            `;
            container.appendChild(div);
            betTargetCount++;
        }
    </script>
</head>
<body>
    <div th:insert="~{fragments/header :: header}"></div>

    <h1>Room Form</h1>

    <div th:if="${errorMessage != null}" style="color: red;">
        <p th:text="${errorMessage}"></p>
    </div>    

    <form action="/room/save" method="post" th:object="${room}">
        <input type="hidden" th:name="userId" th:value="${session.loggedInUser.id}" />

        <label for="roomTitle">タイトル:</label>
        <input type="text" id="roomTitle" name="roomTitle" th:field="*{roomTitle}" th:value="room.title" required><br>

        <label for="roomDescription">詳細:</label>
        <textarea id="roomDescription" name="roomDescription" th:field="*{roomDescription}" th:value="room.roomDescription" required></textarea><br>

        <label for="betMoneyMin">最小掛け金:</label>
        <input type="number" id="betMoneyMin" name="betMoneyMin" th:field="*{betMoneyMin}" th:value="room.betMoneyMin" required><br>

        <label for="betMoneyMax">最大掛け金:</label>
        <input type="number" id="betMoneyMax" name="betMoneyMax" th:field="*{betMoneyMax}" th:value="room.betMoneyMax" required><br>

        <label for="commission">手数料（％）:</label>
        <input type="number" step="0.01" id="commission" name="commission" th:field="*{commission}" th:value="room.commission" required><br>

        <label for="date">開催日:</label>
        <input type="date" id="date" name="date" th:field="*{date}" th:value="room.data" required><br>

        <label for="deadline">締め切り日:</label>
        <input type="date" id="deadline" name="deadline" th:field="*{deadline}" th:value="room.deadline" required><br>

        <input type="hidden" th:name="status" th:value="PENDING" />
        <input type="hidden" th:name="isAfterDeadLine" th:value="false" />

        <h3>Bet Targets</h3>
        <div id="betTargetContainer">
        </div>
        <button type="button" onclick="addBetTarget()">追加</button><br><br>

        <button type="submit">保存</button>
    </form>
</body>
</html>